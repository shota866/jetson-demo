<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>Robot Viewer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@c-frame/aframe-physics-system@4.2.3/dist/aframe-physics-system.min.js"></script>
    <script src="js/config.js"></script>
    <script src="js/components/chase-camera.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sora-js-sdk@latest/dist/sora.js"></script>
    <script src="js/net/sora-client.js" defer></script>
    <script src="js/net/state-recv.js" defer></script>
    <script src="js/net/init.js" defer></script>
    <script src="js/app/shared-scene.js" defer></script>
    <script src="js/app/pose-apply.js" defer></script>
    <script src="js/app/main.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/delaunator@5.0.0/delaunator.min.js"></script>
    <script src="js/components/point-cloud.js"></script>
    <style>
      body { margin: 0; font-family: sans-serif; }
      #netStatusPanel {
        position: absolute;
        top: 10px;
        left: 10px;
        padding: 8px 12px;
        border-radius: 8px;
        background: rgba(10, 12, 20, 0.85);
        color: #f1f5f9;
        font-size: 12px;
        line-height: 1.4;
        min-width: 220px;
        z-index: 1000;
      }
      #netStatusLabel { font-weight: 700; margin-bottom: 4px; }
      #netStatusLabel[data-level='connected'] { color: #16c784; }
      #netStatusLabel[data-level='degraded'] { color: #ffab00; }
      #netStatusLabel[data-level='disconnected'] { color: #ff5252; }
      #poseInfo { margin-top: 4px; font-family: monospace; }
    </style>
  </head>
  <body>
    <div id="netStatusPanel">
      <div id="netStatusLabel" data-level="connecting">CONNECTING</div>
      <div id="netStatusDetail">--</div>
      <div id="poseInfo">pos: --</div>
    </div>

    <a-scene physics="driver: local; debug: false; gravity: -9.8">
      <a-assets>
        <a-asset-item id="carModel" src="assets/kenney_car-kit/Models/GLB format/sedan.glb"></a-asset-item>
        <a-asset-item id="pointCloudData" src="assets/MapViewer3Dpts_out.xyz"></a-asset-item>
        <a-asset-item
          id="mapMesh"
          src="assets/kenney_car-kit/MapViewer3Dpts_out_normal_white_200mm.glb"
        ></a-asset-item>
      </a-assets>

      <a-entity light="type: ambient; intensity: 0.6"></a-entity>
      <a-entity light="type: directional; intensity: 1.0" position="1 3 2"></a-entity>

      <a-entity
        id="chasecam"
        camera="active: true; near: 0.01; far: 2000; fov: 90"
        look-controls="enabled: false"
      ></a-entity>

      <a-plane rotation="-90 0 0" width="120" height="120" color="#dedede"></a-plane>
      <a-sky color="#ECECEC"></a-sky>
      <a-gltf-model src="#mapMesh" rotation="-90 0 0"></a-gltf-model>

      <a-entity xyz-point-cloud="src: #pointCloudData; color: #555; wireframe: false" rotation="-90 0 0"></a-entity>

      <a-entity id="car" position="0 0 0" rotation="0 0 0">
        <a-entity id="carModelNode" gltf-model="#carModel" scale="0.5 0.5 0.5"></a-entity>
      </a-entity>
    </a-scene>
  </body>
</html>
